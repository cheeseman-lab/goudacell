# GoudaCell

Cell segmentation on the Whitehead HPC using Cellpose.

## Getting Started

### 1. Set Up Your Environment (one time)

```bash
# Create the environment
conda create -n goudacell -c conda-forge python=3.11 uv pip -y
conda activate goudacell

# Install goudacell (choose ONE):
uv pip install -e ".[cellpose3]"  # For most cells (rounded shapes)
uv pip install -e ".[cellpose4]"  # For complex cell shapes

# Register as a Jupyter kernel (so it appears in the Jupyter interface)
python -m ipykernel install --user --name goudacell --display-name "goudacell"
```

### 2. Test Parameters on a Few Images

```bash
# Start Jupyter on a GPU node
sbatch scripts/jupyter_gpu.sh

# Check the output file for the URL
cat goudacell_jupyter-*.out
```

Open the notebook at `notebooks/segmentation.ipynb` and:
1. Set your image directory and output directory
2. Run through the cells to test different parameters
3. When happy, run the "Generate Batch Config" cell

### 3. Run Batch Segmentation

```bash
# Use the config file generated by the notebook
sbatch scripts/run_segmentation.sh /path/to/segmentation_config.yaml
```

## Which Cellpose Version?

| Version | Install with | Use for |
|---------|--------------|---------|
| Cellpose 3 | `.[cellpose3]` | Round cells (most common) |
| Cellpose 4 | `.[cellpose4]` | Irregular/complex shapes |

## File Formats Supported

- TIFF (`.tif`, `.tiff`)
- Nikon ND2 (`.nd2`)
- DeltaVision (`.dv`)
